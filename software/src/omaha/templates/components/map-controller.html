<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="/bower_components/iron-icons/image-icons.html">
<link rel="import" href="/bower_components/iron-icons/av-icons.html">
<link rel="import" href="/bower_components/paper-card/paper-card.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/paper-slider/paper-slider.html">
<link rel="import" href="/bower_components/paper-toast/paper-toast.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/paper-styles/paper-styles.html">
<link rel="import" href="/bower_components/neon-animation/neon-animation.html">

<link rel="import" href="/components/speaker-icon.html">

<dom-module id="map-controller">
  <template>
    <style>
      :host {
        display: block;
      }

      .block {
        width: 30px;
        height: 30px;
        position: absolute;
        color: var(--google-grey-700);
      }

      .container {
        width: 100%;
      }

      .container-height {
        height: 100%;
      }
    </style>
    <div class="container-height layout horizontal center">
      <div class="container layout vertical center">
       <div id="cont" style="position: relative;">
         <img id="map" on-click="test" src="/css/map.jpg">
         <template is="dom-repeat" items="{{locations}}">
            <speaker-icon on-click="_iconClicked" x="{{item.x}}" y="{{item.y}}" speaker-id="{{item.id}}"></speaker-icon>
         </template>
       </div>
      </div>
    </div>
  </template>
  <script>
    
    Polymer({
      is: 'map-controller',

      behaviors: [
        Polymer.NeonSharedElementAnimatableBehavior
      ],

      properties: {
        animationConfig: {
          value: function() {
            return {
              'entry': {
                // provided by neon-animation/animations/scale-up-animation.html
                name: 'slide-from-right-animation',
                node: this
              },
              'exit': [{
                name: 'hero-animation',
                id: 'hero',
                fromPage: this
              },{
                name: 'fade-out-animation',
                node: this
              }]
            }
          }
        }
      },

      test: function(event) {
        var rect = this.$.map.getBoundingClientRect();
        var parentX = rect.left;
        var eventX = event.pageX;
        var x = Math.round(Math.min(Math.max(eventX-parentX-15, 0), this.$.map.width-30));
        var parentY = rect.top;
        var eventY = event.pageY;
        var y = Math.round(Math.min(Math.max(eventY-parentY-15, 0), this.$.map.height-30));
        var div = document.createElement("iron-icon");
        div.icon = "av:surround-sound";
        div.className = "block";
        div.style.left = x.toString() + "px";
        div.style.top = y.toString() + "px";
        Polymer.dom(this.$.cont).appendChild(div);
      },

      _iconClicked: function(event) {
        var evnt = Polymer.dom(event);
        this.sharedElements = {
          'hero': event.target
        };
        /*
          event names must be lowercase
        */
        this.fire('speakerselected', {speakerId: evnt.localTarget.speakerId});
        console.log("firing");
      },
      
      ready: function () {
        this.locations = [
          {
            x: 300,
            y: 200,
            id: 107
          },
          {
            x: 150,
            y: 100,
            id: 108
        }];
      }
    });
  </script>
</dom-module>