<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="/bower_components/iron-icons/image-icons.html">
<link rel="import" href="/bower_components/paper-card/paper-card.html">
<link rel="import" href="/bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/paper-slider/paper-slider.html">
<link rel="import" href="/bower_components/paper-toast/paper-toast.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/paper-styles/paper-styles.html">
<link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">

<dom-module id="averaging-controller">
  <template>
    <style>
      :host {
        display: block;
      }
      
      paper-card {
        width: 100%
      }
     
      paper-slider {
        width: 100%;
      }
      
      paper-button {
        background-color: #4285f4;
        color: #fff;
        margin-top: 10px;
      }

      #on {
        background-color: var(--google-yellow-300);
      }

      #off {
        background-color: var(--google-grey-700);
      }

      iron-icon {
        --iron-icon-width: 70px;
        --iron-icon-height: 70px;
      }

      #day {
        color: var(--google-yellow-300);
      }

      #night {
        color: var(--google-grey-700);
      }
    </style>

  <paper-dropdown-menu always-float-label="true" label="Averaging mode:">
    <paper-menu class="dropdown-content">
      <paper-item>Mode 1</paper-item>
      <paper-item>Mode 2</paper-item>
      <paper-item>Mode 3</paper-item>
      <paper-item>Mode 4</paper-item>
      <paper-item>Mode 5</paper-item>
      <paper-item>Mode 6</paper-item>
      <paper-item>Mode 7</paper-item>
      <paper-item>Mode 8</paper-item>
      <paper-item>Mode 9</paper-item>
      <paper-item>Mode 10</paper-item>
      <paper-item>Mode 11</paper-item>
      <paper-item>Mode 12</paper-item>
      <paper-item>Mode 13</paper-item>
      <paper-item>Mode 14</paper-item>
      <paper-item>Mode 15</paper-item>
      <paper-item>Mode 16</paper-item>
      <paper-item>Mode 17</paper-item>
      <paper-item>Mode 18</paper-item>
      <paper-item>Mode 19</paper-item>
      <paper-item>Mode 20</paper-item>
    </paper-menu>
  </paper-dropdown-menu>
    <iron-ajax
      id="ledOnAjax"
      url="/demo/start"
      handle-as="json"
      on-response="_logResponse"
      debounce-duration="300"></iron-ajax>
    <iron-ajax
      id="ledOffAjax"
      url="/demo/stop"
      handle-as="json"
      on-response="_logResponse"
      debounce-duration="300"></iron-ajax>
    <iron-ajax
      id="ledStatusAjax"
      url="/system/"
      handle-as="json"
      on-response="_initializeStatus"
      debounce-duration="300"></iron-ajax>
  </template>
  <script>
    Polymer({
      is: 'averaging-controller',

      _onPressed: function(){
        this._showDay();

        this.$.ledOnAjax.generateRequest();
      },

      _offPressed: function() {
        this._showNight();
        this.$.ledOffAjax.generateRequest();
      },

      _showDay: function() {
        this.$.day.style.display = "block";
        this.$.night.style.display = "none";
      },

      _showNight: function() {
        this.$.day.style.display = "none";
        this.$.night.style.display = "block";
      },

      _logResponse: function(event, data) {
        console.log(data.response);
      },

      _initializeStatus: function(event, data) {
        console.log(data.response.status.controllers["107"].ledOn)
        if(data.response.status.ledOn) {
          this._showDay();
        } else {
          this._showNight();
        }
      },

      ready: function() {
        var elem = this;
        this.$.ledStatusAjax.generateRequest();
      }

    });
  </script>
</dom-module>