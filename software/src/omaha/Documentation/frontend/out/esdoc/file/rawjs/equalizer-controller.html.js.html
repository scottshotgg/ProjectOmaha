<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">rawjs/equalizer-controller.html.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  </ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">rawjs/equalizer-controller.html.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">
  var sliders;
  var handles;
  var background;

  var equalizerToast = 0;
  var equalizerMode;
  var typeFound = 0;

  /**
   * GetValues is used to get the type of equalizer that is currently selected.
   * @return {[integer]} [typeFound is the type of equalizer that was found in interger enumerated form]
   */
  function getValues() {
    switch (equalizerMode.selected) {
      case &quot;masking&quot;: 
        typeFound = 0;
        //console.log(equalizerMode.selected);
        break;
      case &quot;music&quot;:
        typeFound = 1;
        //console.log(equalizerMode.selected);
        break;
      case &quot;paging&quot;:
        typeFound = 2;
        //console.log(equalizerMode.selected);
        break;

      default:
        //console.log(&quot;something is messed up with the equalizerMode = this.$.equalizerSelector.selected;&quot;);
      }

      return typeFound;
  }


  $(document).ready(function() {
    //console.log(&quot;equalizer zoneFlag&quot;, zoneFlag);
    sliders = document.getElementsByClassName(&quot;ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min&quot;);
    handles = document.getElementsByClassName(&quot;ui-slider-handle ui-state-default ui-corner-all&quot;);
    background = document.getElementsByClassName(&quot;custom_slider style-scope equalizer-controller ui-slider ui-slider-vertical ui-widget ui-widget-content ui-corner-all&quot;);

    //console.log(sliders, &quot;\n&quot;, handles, &quot;\n&quot;, background);

  });
  
  var lastSelected = 0;
  var isThereAnError = false;



  var lastEQMode = &quot;masking&quot;;
  var iirConstants = [];

  for(loopVar = 0; loopVar &lt; 63; loopVar++) {
    iirConstants[loopVar] = 0;
  }
  //console.log(iirConstants);

  /**
   * This function is used to show the switching dialog that notifies the user of the implications of their changes when switching equalizers.
   */
  function showEqualizerSwitchDialog(mode) {
    //console.log(mode);
    switch(mode) {
      case &quot;masking&quot;: {
        document.getElementById(&quot;eqmode&quot;).innerHTML = &quot;You are switching the speaker to masking mode&lt;br&gt;In this mode, the speaker will produce equalized white noise and unequalized music.&quot;;
        break;
      }
      case &quot;music&quot;: {
        document.getElementById(&quot;eqmode&quot;).innerHTML = &quot;You are switching the speaker to music mode&lt;br&gt;In this mode the speaker will produce equalized music only.&quot;;
        break;
      }
      case &quot;paging&quot;: {
        document.getElementById(&quot;eqmode&quot;).innerHTML = &quot;You are switching the speaker to paging mode;&lt;br&gt;Something needs to go here, ask Matt&quot;
        break;
      }
    }
    document.querySelector(&quot;#switchingEQModeDialog&quot;).toggle();
    //console.log(&quot;i got here&quot;);
  }

  /**
   * This function is used for changing the equalizer mode. It also takes care of some UI switching as well, such as hiding and showing the appropriate menus for the equalizers.
   */
  function modeChanged(mode) {

    switch(mode) {
      case &quot;masking&quot;:
        equalizerMenu.style.visibility = &quot;visible&quot;;
        musicMenu.style.visibility = &quot;hidden&quot;;
        pagingMenu.style.visibility = &quot;hidden&quot;;
        showEqualizerSwitchDialog(&quot;masking&quot;);
        break;

      case &quot;music&quot;:
        equalizerMenu.style.visibility = &quot;hidden&quot;;
        musicMenu.style.visibility = &quot;visible&quot;;
        pagingMenu.style.visibility = &quot;hidden&quot;;
        showEqualizerSwitchDialog(&quot;music&quot;);
        break;
      
      case &quot;paging&quot;:
        equalizerMenu.style.visibility = &quot;hidden&quot;;
        musicMenu.style.visibility = &quot;hidden&quot;;
        pagingMenu.style.visibility = &quot;visible&quot;;
        showEqualizerSwitchDialog(&quot;paging&quot;);
        break;

      default: 
        //console.log(&quot;SOMETHING WAS WRONG WITH WHAT WAS PASSED TO modeChanged()&quot;);
    }
  }


    Polymer({
      is: &apos;equalizer-controller&apos;,
      
      properties: {
        internalEqualizer: String,

        mode: {
        type:  String,
        value: &quot;masking&quot;
        },

        speakerId: {
          type: Number
        },

        speaker: {
          type: Object
        },

        equalizer: {
          type: String,
          notify: true,
          observer: &apos;_setInternalEqualizer&apos;
        }
      },

      /**
       * Setting the internal equalizer has internal effects so that the system can keep track of itself. It sets a variable that when set fires a function to update the server of its value.
       */
      _setInternalEqualizer: function(iirConstantsString) {
        this.internalEqualizer = iirConstantsString;
        //console.log(&quot;_setInternalEqualizer &quot; + iirConstantsString);
      },
      
      /**
       * This function sets the equalizer value and is the function that is fired when the user presses the &apos;set equalizer&apos; button. This function validates the bands to make sure that correct values are being submitted.
       */
      _setEqualizerClicked: function() {

        //console.log(&quot;equalizer clicked zoneFlag&quot;, zoneFlag);

        var checkInt = 0;
        var checkBands = [];
        var equalizerText = &quot;Invalid input at &quot;;

        $(document.getElementsByClassName(&quot;level&quot;)).each(function(i) {
          typeof this.value;
          if(isNaN(this.value) || this.value == &quot;&quot; || this.value &lt; -40 || this.value &gt; 10) {
            //console.log(this, this.name, this.value);
            checkInt++;
            checkBands.push(this.name);
          }
        });

        if(checkInt &gt; 0) {
          if(checkBands.length == 1) {
            equalizerText += checkBands[0] + &quot;Hz&quot;;
          } else {
            for (var i = 0; i &lt; checkBands.length - 1; i++) {
              equalizerText += checkBands[i] + &quot;Hz, &quot;
            }
            equalizerText += &quot;and &quot; + checkBands[checkBands.length - 1] + &quot;Hz&quot;;
          }
          this.$.equalizerToast.duration = 2000 + (500 * checkBands.length);
          this.$.equalizerToast.text = equalizerText;
          this.$.equalizerToast.show();
        } else {


          this.equalizer = iirConstants.slice(0 + (21 * typeFound), 21 + (21 * typeFound)).join(&quot; &quot;);
          //console.log(this.equalizer);
          this.iirConstantsString = iirConstants.slice(0 + (21 * typeFound), 21 + (21 * typeFound)).join(&quot;, &quot;);


          this.$.equalizerToast.text = &quot;Equalizer set to &quot; + this.iirConstantsString;
          this.$.equalizerToast.show();
          //console.log(&quot;_setEqualizerClicked&quot;);
          //console.log(iirConstants);
          
          for (var i = 0; i &lt; this.speaker.CurrentPreset.length; i++) { 
            this.speaker.CurrentPreset[i] = iirConstants[i];
          }
        }
      },

      _logResponse: function(event, data) {
        //console.log(&quot;shuddup&quot;);
        //console.log(event, data);
      },

      /**
       * This function is used when the the user adds a preset and clicks the &apos;add&apos; button on the assisting dialog.
       */
      _acceptPressed: function(event) {
        var name = this.$.popupInput.value.valueOf().replace(&quot;\n&quot;, &quot;&quot;).replace(&quot;\t&quot;, &quot;&quot;);
        var ifvar = 0;
        if(this.speaker.PresetNames.length &gt; 0) {
          for(var i = 0; i &lt; this.speaker.PresetNames.length; i++) {
            if(name.toLowerCase() == this.speaker.PresetNames[i].valueOf().toLowerCase()) {
              //console.log(&quot;same name dude&quot;);
              ifvar++;
            }
          }
        }

        if(ifvar &gt; 0) {
          //console.log(&quot;we are in here right now&quot;);
          this.err = &quot;Invalid name: Name already taken&quot;;
          this.$.toasty.text = this.err;
          this.$.toasty.show();
        } else {
          this.$.addPresetAjax.body = {
            &quot;speaker&quot;: this.speakerId,
            &quot;name&quot;: name,
            &quot;type&quot;: getValues(),
            &quot;constants&quot;: iirConstants.join(&quot; &quot;),
          };

          //console.log(iirConstants.join(&quot; &quot;));

          //console.log(&quot;addPresetAjax:&quot;, addPresetAjax.body);
          this.$.addPresetAjax.generateRequest();

          this.$.dialog.toggle();

          this.$.toasty.text = &quot;Added preset: &quot; + name + &quot; &quot; + iirConstants.join(&quot;, &quot;);
          //console.log(this.$.toasty.text);

          this.$.toasty.show();

          temp = document.createElement(&quot;paper-item&quot;);
          temp.setAttribute(&quot;value&quot;, name);
          temp.setAttribute(&quot;id&quot;, name);
          temp.innerHTML = name;
          Polymer.dom(this.$.equalizerListbox).appendChild(temp);

          var length = this.speaker.Equalizer.length;
          //console.log(length);

          //console.log(iirConstants);

          var iirConstantsCopy = iirConstants.slice();

          //console.log(&quot;iirConstantsCopy: &quot;, iirConstantsCopy);
          this.speaker.Equalizer.push(iirConstants.slice());
          //}

          this.speaker.PresetNames[this.speaker.PresetNames.length] = name;

          //console.log(this.speaker.Equalizer);

          this.$.equalizerListbox.selected = name;
          this.$.popupInput.value = &quot;&quot;;
        }
      },

      /**
       * This function dismisses the dialog and resets the selected preset.
       */
      _cancelPressed: function(event) {
        this.$.equalizerListbox.selected = -1;
        //console.log(lastSelected);
      },

      /**
       * This function is used when the the user accepts the implications of their selection using the &apos;switch&apos; button on the dialog.
       */
      _switchPressed: function(event) {
        this.$.changeEQModeAjax.body = {
          &quot;speaker&quot;:  this.speakerId,
          &quot;mode&quot;:     getValues(),
        };

        this.$.changeEQModeAjax.generateRequest();

        this.$.switchingEQModeDialog.toggle();
        lastEQMode = this.$.equalizerSelector.selected;
        //console.log(lastEQMode);
      },

      /**
       * This function is used when the user decided against switching equalizers and clicks the cancel button on the switch dialog.
       */
      _cancelSwitchPressed: function(event) {
        switch(lastEQMode) {
          case &quot;masking&quot;:
            musicMenu.style.visibility = &quot;hidden&quot;;
            equalizerMenu.style.visibility = &quot;visible&quot;;
            break;

          case &quot;music&quot;:
            musicMenu.style.visibility = &quot;visible&quot;;
            equalizerMenu.style.visibility = &quot;hidden&quot;;
            break;

          default:
            //console.log(&quot;fuck me&quot;);
        }
        this.$.equalizerSelector.selected = lastEQMode;
      },

      listeners: {
        &apos;equalizerListbox.iron-select&apos;: &apos;_presetSelectionChanged&apos;
      },

      /**
       * PresetSelectionChanged is fired when the user selects a new preset that is then used to set the equalizer to the corresponding values.
       */
      _presetSelectionChanged: function(event) {
        //console.log(this.speakerId);
        //console.log(this.speaker);

        var selected = this.$.equalizerListbox.selected.valueOf().toLowerCase().replace(&quot;\n&quot;, &quot;&quot;);

        if(selected == &quot;currently applied&quot;) {
          this.$.toasty.text = &quot;Currently applied constants loaded! &quot; + iirConstants.join(&quot;, &quot;);
          this.$.toasty.show();

          lastSelected = this.$.equalizerListbox.selected;

          for (var i = 0; i &lt; this.speaker.CurrentPreset.length; i++) { 
            sliders[i].style.height = (this.speaker.CurrentPreset[i] + 40) * 2 + &quot;%&quot;;
            //console.log(this);
            handles[i].style.bottom = (this.speaker.CurrentPreset[i] + 40) * 2 + &quot;%&quot;;
            $(&quot;#text&quot; + (parseInt(i) + 1)).val(this.speaker.CurrentPreset[i]);
            iirConstants[i] = this.speaker.CurrentPreset[i];       
          }
        } else if(selected == &quot;add new preset&quot;) {
            var addPresetAjax = document.getElementById(&quot;addPresetAjax&quot;);
            //console.log(addPresetAjax);
            this.$.dialog.toggle();
        } else if(this.speaker.PresetNames.length &gt; 0) {
            lastSelected = this.$.equalizerListbox.selected;
            var associationLink = -1;
            for (k in this.speaker.PresetNames) {
              if(selected == this.speaker.PresetNames[k].valueOf().toLowerCase()) {
                this.$.toasty.text = this.$.equalizerListbox.selected + &quot; preset loaded! &quot; + iirConstants.join(&quot;, &quot;);
                this.$.toasty.show();
                //console.log(&quot;Speaker &quot; + this.speakerId + &quot; selected preset: &quot; + selected);
                associationLink = k;
                //console.log(&quot;associationLink&quot;, associationLink);
                break;
              }
            }
            if(associationLink != -1) {
              //console.log(this.speaker.Equalizer.length);
              for (var j = 0; j &lt; this.speaker.Equalizer[0].length; j++) {
                sliders[j].style.height = (this.speaker.Equalizer[associationLink][j] + 40) * 2 + &quot;%&quot;;
                handles[j].style.bottom = (this.speaker.Equalizer[associationLink][j] + 40) * 2 + &quot;%&quot;;
                $(&quot;#text&quot; + (parseInt(j) + 1)).val(this.speaker.Equalizer[associationLink][j]);
                iirConstants[j] = this.speaker.Equalizer[associationLink][j];
              }
            }
          }
      },
      
      resetKnob: function(elem) {
        elem.prevTimeout = 0;
        elem.$.volume2._resetKnob();
      },

      showToast: function() {
        //console.log(&quot;gi&quot;);
      },

      /**
       * On ready, the function takes the equalizer constants and sets the internal equalizer and assigns the toasts to global values so that they are accessible outside the selectors scope.
       */
      ready: function() {
        //console.log(&quot;this.$&quot;, this.$);
        this.internalEqualizer = this.iirConstantsString;
        equalizerToast = this.$.equalizerToast;
        equalizerMode = this.$.equalizerSelector;
      }
    });

    function showToast() {
      //console.log(&quot;gi&quot;);
    }

    /**
     * InputChanged is used when the user types a value into the text box for the slider. This function will validate that the value entered is completely numeric (ie, integer or float) and is between 10 and -40.
     */
    function inputChanged() {
        var error = false;
      $(document.getElementsByClassName(&quot;level&quot;)).each(function(i) {
        //console.log(this.value);
        if(isNaN(this.value) || this.value == &quot;&quot; || this.value &lt; -40 || this.value &gt; 10) {
          error = true;
          sliders[i].style.background = &quot;#F33F31&quot;;
          handles[i].style.background = &quot;#F33F31&quot;;
          background[i].style.background = &quot;rgba(243, 63, 49, .2)&quot;;
          
        } else {        
          iirConstants[i] = parseInt(this.value);
          sliders[i].style.background = &quot;#3f51b5&quot;;
          handles[i].style.background = &quot;#3f51b5&quot;;
          background[i].style.background = &quot;rgba(63, 81, 181, .2)&quot;;

          sliders[i].style.height = (iirConstants[i] + 40) * 2 + &quot;%&quot;;
          handles[i].style.bottom = (iirConstants[i] + 40) * 2 + &quot;%&quot;;
        }
      });
        //console.log(error);

        if(error == false) {
          isThereAnError = false;
        } else {
          isThereAnError = true;
        }

        //console.log(isThereAnError);
    }

  var MIN_WIDTH_SUPPORTED = 0;
  var MIN_HEIGHT_SUPPORTED = 0;

  if($(window).width() &gt; MIN_WIDTH_SUPPORTED || $(window).height() &gt; MIN_HEIGHT_SUPPORTED) {
    $(function() {
      $(&quot;.custom_slider&quot;).each(function(i) {
        //console.log(&quot;this is me, the eq: &quot;, i);
        var texts = $(&quot;#text&quot; + (i + 1) + &quot;:nth-child(1)&quot;);
        $(this).slider({
          orientation: &quot;vertical&quot;,
          range: &quot;min&quot;,
          step: .01,
          min: -40,
          max: 10,
          value: 0,
          slide: function( event, ui) {
            isThereAnError = false;
            sliders[i].style.background = &quot;#3f51b5&quot;;
            handles[i].style.background = &quot;#3f51b5&quot;;
            background[i].style.background = &quot;rgba(63, 81, 181, .2)&quot;;
            //console.log(texts);
            $(texts[0]).val(ui.value);

            iirConstants[i] = ui.value;
          }
        });
        $(texts[0]).val($(&quot;.custom &gt; .custom_slider&quot;).slider(&quot;value&quot;));
        //console.log(texts);
      });
    });
  } else {
      //console.log(&quot;there is not enough space to display the equalizer&quot;);     
    }
  $(window).resize(function() {
    if($(window).width() &lt; MIN_WIDTH_SUPPORTED || $(window).height() &lt; MIN_HEIGHT_SUPPORTED) {
      //console.log($(window).width());

      //console.log(document.getElementById(&quot;eighty&quot;).offsetWidth);
    } else {
      var custom_container = document.getElementById(&quot;custom_container&quot;);
    }
  });

</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.7)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
